/*--------------------------------*- C++ -*----------------------------------*\
| =========                 |                                                 |
| \\      /  F ield         | OpenFOAM: The Open Source CFD Toolbox           |
|  \\    /   O peration     | Version:  v2112                                 |
|   \\  /    A nd           | Website:  www.openfoam.com                      |
|    \\/     M anipulation  |                                                 |
\*---------------------------------------------------------------------------*/
FoamFile
{
    version     2.0;
    format      ascii;
    class       dictionary;
    object      blockMeshDict;
}
// * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * //

scale  0.01;

nconv 20;
nr 10;
// * * * * Local Variables * * * * //

// Combustion Chanmber
L_combustion 7.62;
D_combustion 1.4;
L_postcombustion 7.62;
D_pc1 1.4;
D_pc2 1.91;

// CD Nozzle
R_throat 0.2245;
D_in #calc "sqrt(9.71)*$R_throat*2";
Rin #calc "$D_in/2";
converge_hangle 40.0*degToRad();
diverge_hangle 15.0*degToRad();
diverge_ratio 10.0;
converge_ratio #calc "pow($Rin/$R_throat, 2)";

R1 #calc "1.5*$R_throat";
// Convergent Portion
//Rin #calc "sqrt($converge_ratio) * $R_throat";
Rn #calc "$R_throat + $R1*(1 - cos($converge_hangle))";
L_conv #calc "($Rin - $Rn)/tan($converge_hangle)";
L_cc #calc "$R1*sin($converge_hangle)";

// Divergent Portion
Rexit #calc "sqrt($diverge_ratio)*$R_throat";
Rne #calc "$R_throat + $R1*(1 - cos($diverge_hangle))";
L_div #calc "($Rexit - $Rne)/tan($diverge_hangle)";
L_cd #calc "$R1*sin($diverge_hangle)";

// Atmosphere
Ratm 20;
Latm 60;
Habove	0.31;
Lbefore 5;
R6 #calc "$Rexit + $Habove";
R7 #calc "6*$Rexit";

////////////////////// vertices //////////////////////////

//Combustion Chamber
z1 0;
z2 $L_combustion;
x1 #calc "$D_combustion/2";
x2_1 #calc "$D_pc1/2";

// Post Combustion Chamber
x2_2 #calc "$D_pc2/2";

// CD Nozzle
z3 #calc "$z2 + $L_postcombustion";
z4 #calc "$z3 + $L_conv";
zc #calc "$z4 + $L_cc";
z5 #calc "$z4 + $L_cc + $L_cd";
z6 #calc "$z5 + $L_div";
z7 #calc "$z6 + $Latm";
zup #calc "$z3 - $Lbefore";


x3 $Rin;
x4 $Rn;
xc $R_throat;
x5 $Rne;
x6 $Rexit;
x7 $R6;
x8 $R7;
x9 $Ratm;

// Wedge Parameters
wedge_hangle 2.5*degToRad();

// Combustion Wedge 1
y1pw1 #calc "$x1*sin($wedge_hangle)";
y1nw1 #calc "-$y1pw1";
x1w1 #calc "$x1*cos($wedge_hangle)";

y2pw1 #calc "$x2_1*sin($wedge_hangle)";
y2nw1 #calc "-$y2pw1";
x2w1 #calc "$x2_1*cos($wedge_hangle)";

// Post Combustion Wedge 2
y1pw2 #calc "$x2_2*sin($wedge_hangle)";
y1nw2 #calc "-$y1pw2";
x1w2 #calc "$x2_2*cos($wedge_hangle)";

y2pw2 #calc "$x2_2*sin($wedge_hangle)";
y2nw2 #calc "-$y2pw2";
x2w2 #calc "$x2_2*cos($wedge_hangle)";

// converging Wedge 3
y1pw3 #calc "$x3*sin($wedge_hangle)";
y1nw3 #calc "-$y1pw3";
x1w3 #calc "$x3*cos($wedge_hangle)";

y2pw3 #calc "$x4*sin($wedge_hangle)";
y2nw3 #calc "-$y2pw3";
x2w3 #calc "$x4*cos($wedge_hangle)";

// Throat Wedge 4
y1pw4 #calc "$x4*sin($wedge_hangle)";
y1nw4 #calc "-$y1pw4";
x1w4 #calc "$x4*cos($wedge_hangle)";

y2pw4 #calc "$x5*sin($wedge_hangle)";
y2nw4 #calc "-$y2pw4";
x2w4 #calc "$x5*cos($wedge_hangle)";

ycpw4 #calc "$xc*sin($wedge_hangle)";
ycnw4 #calc "-$ycpw4";
xcw4 #calc "$xc*cos($wedge_hangle)";

// diverging Wedge 5
y1pw5 #calc "$x5*sin($wedge_hangle)";
y1nw5 #calc "-$y1pw5";
x1w5 #calc "$x5*cos($wedge_hangle)";

y2pw5 #calc "$x6*sin($wedge_hangle)";
y2nw5 #calc "-$y2pw5";
x2w5 #calc "$x6*cos($wedge_hangle)";

// block 6
y1pw6 #calc "$x7*sin($wedge_hangle)";
y1nw6 #calc "-$y1pw6";
x1w6 #calc "$x7*cos($wedge_hangle)";

y2pw6 #calc "$x7*sin($wedge_hangle)";
y2nw6 #calc "-$y2pw6";
x2w6 #calc "$x7*cos($wedge_hangle)";

// Extend Domain
x6Above #calc "$x6 + $Habove";
x1lw7 #calc "$x6Above*cos($wedge_hangle)";
x2lw7 #calc "$x6Above*cos($wedge_hangle)";
x1hw7 #calc "$x7*cos($wedge_hangle)";
x2hw7 #calc "$x7*cos($wedge_hangle)";

y1lpw7 #calc "$x6Above*sin($wedge_hangle)";
y1lnw7 #calc "-$y1lpw7";
y1hpw7 #calc "$x7*sin($wedge_hangle)";
y1hnw7 #calc "-$y1hpw7";

y2lpw7 #calc "$x6Above*sin($wedge_hangle)";
y2lnw7 #calc "-$y2lpw7";
y2hpw7 #calc "$x7*sin($wedge_hangle)";
y2hnw7 #calc "-$y2hpw7";

// Block 7
ly1b7 #calc "$x7*sin($wedge_hangle)";
ly2b7 #calc "-$ly1b7";
hy1b7 #calc "$x8*sin($wedge_hangle)";
hy2b7 #calc "-$hy1b7";

lxb7 #calc "$x7*cos($wedge_hangle)";
hxb7 #calc "$x8*cos($wedge_hangle)";

// Block 8
ly1b8 #calc "$x8*sin($wedge_hangle)";
ly2b8 #calc "-$ly1b8";
hy1b8 #calc "$x9*sin($wedge_hangle)";
hy2b8 #calc "-$hy1b8";

lxb8 #calc "$x8*cos($wedge_hangle)";
hxb8 #calc "$x9*cos($wedge_hangle)";

// Discretization
dx #calc "$L_conv/$nconv";
ncomb #calc "ceil($L_combustion/$dx)";
npcomb #calc "ceil($L_postcombustion/$dx)";
ncurve #calc "ceil(($L_cc+$L_cd)/$dx)";
ndiv #calc "ceil($L_div/$dx)";
// * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * //

vertices
(
  // Combustion Chamber
  (0 0 $z1)
  ($x1w1 $y1pw1 $z1)
  ($x2w1 $y2pw1 $z2)
  (0 0 $z2)
  ($x1w1 $y1nw1 $z1)
  ($x2w1 $y2nw1 $z2)

  // Post Combustion Chamber
  (0 0 $z2)
  ($x1w2 $y1pw2 $z2)
  ($x2w2 $y2pw2 $z3)
  (0 0 $z3)
  ($x1w2 $y1nw2 $z2)
  ($x2w2 $y2nw2 $z3)

  // CD Nozzle: Converging portion
  (0 0 $z3)
  ($x1w3 $y1pw3 $z3)
  ($x2w3 $y2pw3 $z4)
  (0 0 $z4)
  ($x1w3 $y1nw3 $z3)
  ($x2w3 $y2nw3 $z4)

  // CD Nozzle: Throat
  (0 0 $z4)
  ($x1w4 $y1pw4 $z4)
  ($x2w4 $y2pw4 $z5)
  (0 0 $z5)
  ($x1w4 $y1nw4 $z4)
  ($x2w4 $y2nw4 $z5)

  // CD Nozzle: Diverging portion
  (0 0 $z5)
  ($x1w5 $y1pw5 $z5)
  ($x2w5 $y2pw5 $z6)
  (0 0 $z6)
  ($x1w5 $y1nw5 $z5)
  ($x2w5 $y2nw5 $z6)

  // Downstream Nozzle Exit
  (0 0 $z6)
  ($x1w6 $y1pw6 $z6)
  ($x2w6 $y2pw6 $z7)
  (0 0 $z7)
  ($x1w6 $y1nw6 $z6)
  ($x2w6 $y2nw6 $z7)

  // Downstream top
  ($lxb7 $ly2b7 $zup)
  ($hxb7 $hy2b7 $zup)
  ($hxb7 $hy1b7 $zup)
  ($lxb7 $ly1b7 $zup)

  ($lxb7 $ly2b7 $z7)
  ($hxb7 $hy2b7 $z7)
  ($hxb7 $hy1b7 $z7)
  ($lxb7 $ly1b7 $z7)

  // Downstream atm
  ($lxb8 $ly2b8 $zup)
  ($hxb8 $hy2b8 $zup)
  ($hxb8 $hy1b8 $zup)
  ($lxb8 $ly1b8 $zup)

  ($lxb8 $ly2b8 $z7)
  ($hxb8 $hy2b8 $z7)
  ($hxb8 $hy1b8 $z7)
  ($lxb8 $ly1b8 $z7)

  // Extend Region
  ($x1lw7 $y1lnw7 $zup)
  ($x1hw7 $y1hnw7 $zup)
  ($x1hw7 $y1hpw7 $zup)
  ($x1lw7 $y1lpw7 $zup)
  ($x2lw7 $y2lnw7 $z6)
  ($x2hw7 $y2hnw7 $z6)
  ($x2hw7 $y2hpw7 $z6)
  ($x2lw7 $y2lpw7 $z6)
);

blocks
(
  hex (0 4 1 0 3 5 2 3) (30 1 200) simpleGrading
  		(
		((0.5 0.5 4)(0.5 0.5 0.2)) 	1
		 (
		  (0.3 0.35 3.0)
		  (0.3 0.25 1.0)
		  (0.4 0.4 0.5)
		 )
		)
  hex (6 10 7 6 9 11 8 9) (50 1 200) simpleGrading
  		(
		 (
		  (0.3665 0.3 4)
		  (0.3665 0.3 0.2)
		  (0.1335 0.2 2.0)
		  (0.1335 0.2 0.4)
		 )
		 1
		 ((0.5 0.5 2)(0.5 0.5 0.5))
		)
  hex (12 16 13 12 15 17 14 15) (30 1 40) simpleGrading (((0.5 0.5 4)(0.5 0.5 0.2)) 1 0.25)
  hex (18 22 19 18 21 23 20 21) (30 1 55) simpleGrading (((0.5 0.5 4)(0.5 0.5 0.2)) 1 1)
  hex (24 28 25 24 27 29 26 27) (30 1 140) simpleGrading (((0.5 0.5 4)(0.5 0.5 0.2)) 1 ((0.4 0.514 2.5)(0.3 0.257 1.0)(0.3 0.229 1.0)))
//  hex (30 34 31 30 33 35 32 33) (25 1 250) simpleGrading (((69.5 60 0.4)(30.5 40 1)) 1 4) // (15N + 15E + B,  1, 70)
//  hex (36 37 38 39 40 41 42 43) (20 1 300) simpleGrading (3 1 ((11.186 16.66 0.5)(88.814 83.33 4)))
//  hex (44 45 46 47 48 49 50 51) (40 1 300) simpleGrading (3 1 ((11.19 16.66 0.5)(88.81 83.33 4)))
);

edges
(
  arc 19 20 ($xcw4 $ycpw4 $zc)
  arc 22 23 ($xcw4 $ycnw4 $zc)
);

boundary
(
     front
     {
           type wedge;
           faces
           (
               (0 3 2 1)
               (6 9 8 7)
               (12 15 14 13)
	       (18 21 20 19)
	       (24 27 26 25)
//	       (30 33 32 31)
//	       (39 43 42 38)
//	       (47 51 50 46)
           );
      }
     back
     {
           type wedge;
           faces
           (
               (0 4 5 3)
               (6 10 11 9)
               (12 16 17 15)
	       (18 22 23 21)
	       (24 28 29 27)
//	       (30 34 35 33)
//	       (36 37 41 40)
//	       (44 45 49 48)
           );
      }
     Wall
     {
           type wall;
           faces
           (
               //(1 2 5 4)
               (0 1 4 0)
               (7 8 11 10)
           );
     }
     nozzleWall
     {
	   type wall;
	   faces
	   (
	       (13 14 17 16)
	       (19 20 23 22)
	       (25 26 29 28)
	       //(36 40 43 39)
	   );
     }
     inlet
     {
           type patch;
           faces
           (
               // (0 1 4 0)
               (1 2 5 4)
           );
      }
     outlet
     {
           type patch;
           faces
           (
	       (27 29 26 27)
	       //(33 35 32 33)
	       //(40 41 42 43)
	       //(48 49 50 51)
	       //(31 32 35 34)
	       //(36 39 38 37)
	       //(37 38 42 41)
           );
      }
     axis
     {
           type empty;
           faces
           (
               (0 3 3 0)
               (6 9 9 6)
               (12 15 15 12)
	       (18 21 21 18)
	       (24 27 27 24)
//	       (30 33 33 30)
           );
      }
      block1
      {
          type default;
          faces
          (
              (3 5 2 3)
          );
      }
      block2I1
      {
          type default;
          faces
          (
              (6 10 7 6)
          );
      }
      PCWall
      {
          type default;
          faces
          (
              (9 11 8 9)
          );
      }
      block3I1
      {
          type default;
          faces
          (
              (12 16 13 12)
          );
      }
      block3I2
      {
          type default;
          faces
          (
              (15 17 14 15)
          );
      }
      block4I1
      {
          type default;
          faces
          (
              (18 22 19 18)
          );
      }
      block4I2
      {
          type default;
          faces
          (
              (21 23 20 21)
          );
      }
      block5I1
      {
          type default;
          faces
          (
              (24 28 25 24)
          );
      }
      block5I2
      {
          type default;
          faces
          (
      //        (27 29 26 27)
          );
      }

      nozzleAtmWall
      {
          type default;
          faces
          (
    //          (30 34 31 30)
              //(40 41 42 43)
          );
      }

      block6Itop
      {
	   type default;
	   faces
           (
  //              (31 32 35 34)
	   );
      }
      block7Itop
      {
	   type default;
	   faces
           (
//	        (37 38 42 41)
	   );
      }
      block8Ibot
      {
	   type default;
	   faces
	   (
//	        (44 48 51 47)
	   );
      }
      master
      {
          type default;
          faces
          (
              //(30 34 31 30)
          );
      }
      slave
      {
          type  default;
          faces
          (
              //(40 41 42 43)
              //(27 29 26 27)
          );
      }
);

mergePatchPairs
(
  ( block1 block2I1 )
  ( PCWall block3I1 )
  ( block3I2 block4I1 )
  ( block4I2 block5I1 )
  //( block5I2 nozzleAtmWall)
  //( atmWall block6Itop )
  //( block7Itop block8Ibot )
);
// ************************************************************************* //
